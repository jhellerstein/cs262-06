<html xmlns:o="urn:schemas-microsoft-com:office:office"xmlns:w="urn:schemas-microsoft-com:office:word"xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=Title content=ACPM><meta name=Keywords content=""><meta http-equiv=Content-Type content="text/html; charset=macintosh"><meta name=ProgId content=Word.Document><meta name=Generator content="Microsoft Word 11"><meta name=Originator content="Microsoft Word 11"><link rel=File-List href="ACPM-BufMgr_files/filelist.xml"><title>ACPM</title><!--[if gte mso 9]><xml> <o:DocumentProperties>  <o:Template>Normal</o:Template>  <o:LastAuthor>Joe Hellerstein</o:LastAuthor>  <o:Revision>2</o:Revision>  <o:Created>2005-09-22T08:37:00Z</o:Created>  <o:LastSaved>2005-09-22T08:37:00Z</o:LastSaved>  <o:Pages>1</o:Pages>  <o:Words>1510</o:Words>  <o:Characters>8612</o:Characters>  <o:Lines>71</o:Lines>  <o:Paragraphs>17</o:Paragraphs>  <o:CharactersWithSpaces>10576</o:CharactersWithSpaces>  <o:Version>11.257</o:Version> </o:DocumentProperties> <o:OfficeDocumentSettings>  <o:AllowPNG/> </o:OfficeDocumentSettings></xml><![endif]--><!--[if gte mso 9]><xml> <w:WordDocument>  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>  <w:UseMarginsForDrawingGridOrigin/> </w:WordDocument></xml><![endif]--><style><!-- /* Font Definitions */@font-face	{font-family:"Times New Roman";	panose-1:0 2 2 6 3 5 4 5 2 3;	mso-font-charset:0;	mso-generic-font-family:auto;	mso-font-pitch:variable;	mso-font-signature:50331648 0 0 0 1 0;}@font-face	{font-family:Arial;	panose-1:0 2 11 6 4 2 2 2 2 2;	mso-font-charset:0;	mso-generic-font-family:auto;	mso-font-pitch:variable;	mso-font-signature:50331648 0 0 0 1 0;}@font-face	{font-family:"Courier New";	panose-1:0 2 7 3 9 2 2 5 2 4;	mso-font-charset:0;	mso-generic-font-family:auto;	mso-font-pitch:variable;	mso-font-signature:50331648 0 0 0 1 0;}@font-face	{font-family:Wingdings;	panose-1:0 5 2 1 2 1 8 4 8 7;	mso-font-charset:2;	mso-generic-font-family:auto;	mso-font-pitch:variable;	mso-font-signature:0 0 256 0 -2147483648 0;} /* Style Definitions */p.MsoNormal, li.MsoNormal, div.MsoNormal	{mso-style-parent:"";	margin:0in;	margin-bottom:.0001pt;	mso-pagination:widow-orphan;	font-size:12.0pt;	font-family:"Times New Roman";}h1	{mso-style-next:Normal;	margin-top:12.0pt;	margin-right:0in;	margin-bottom:3.0pt;	margin-left:0in;	mso-pagination:widow-orphan;	page-break-after:avoid;	mso-outline-level:1;	font-size:16.0pt;	font-family:Arial;	mso-font-kerning:16.0pt;}h2	{mso-style-next:Normal;	margin-top:12.0pt;	margin-right:0in;	margin-bottom:3.0pt;	margin-left:0in;	mso-pagination:widow-orphan;	page-break-after:avoid;	mso-outline-level:2;	font-size:14.0pt;	font-family:Arial;	font-style:italic;}h3	{mso-style-next:Normal;	margin-top:12.0pt;	margin-right:0in;	margin-bottom:3.0pt;	margin-left:0in;	mso-pagination:widow-orphan;	page-break-after:avoid;	mso-outline-level:3;	font-size:13.0pt;	font-family:Arial;}h4	{mso-style-next:Normal;	margin-top:12.0pt;	margin-right:0in;	margin-bottom:3.0pt;	margin-left:0in;	mso-pagination:widow-orphan;	page-break-after:avoid;	mso-outline-level:4;	font-size:14.0pt;	font-family:"Times New Roman";}p.MsoList2, li.MsoList2, div.MsoList2	{margin-top:0in;	margin-right:0in;	margin-bottom:0in;	margin-left:.5in;	margin-bottom:.0001pt;	text-indent:-.25in;	mso-pagination:widow-orphan;	font-size:12.0pt;	font-family:"Times New Roman";}p.MsoListBullet2, li.MsoListBullet2, div.MsoListBullet2	{mso-style-update:auto;	margin-top:0in;	margin-right:0in;	margin-bottom:0in;	margin-left:.5in;	margin-bottom:.0001pt;	text-indent:-.25in;	mso-pagination:widow-orphan;	mso-list:l0 level1 lfo11;	tab-stops:list .5in;	font-size:12.0pt;	font-family:"Times New Roman";}p.MsoBodyText, li.MsoBodyText, div.MsoBodyText	{margin-top:0in;	margin-right:0in;	margin-bottom:6.0pt;	margin-left:0in;	mso-pagination:widow-orphan;	font-size:12.0pt;	font-family:"Times New Roman";}a:link, span.MsoHyperlink	{color:blue;	text-decoration:underline;	text-underline:single;}a:visited, span.MsoHyperlinkFollowed	{color:purple;	text-decoration:underline;	text-underline:single;}table.MsoNormalTable	{mso-style-parent:"";	font-size:10.0pt;	font-family:"Times New Roman";}@page Section1	{size:8.5in 11.0in;	margin:1.0in 1.25in 1.0in 1.25in;	mso-header-margin:.5in;	mso-footer-margin:.5in;	mso-paper-source:0;}div.Section1	{page:Section1;} /* List Definitions */@list l0	{mso-list-id:-125;	mso-list-type:simple;	mso-list-template-ids:-980134320;}@list l0:level1	{mso-level-number-format:bullet;	mso-level-style-link:"List Bullet 2";	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l1	{mso-list-id:1;	mso-list-type:hybrid;	mso-list-template-ids:1 0 -1 -1 -1 -1 -1 -1 -1 -1;}@list l1:level1	{mso-level-number-format:bullet;	mso-level-text:"%6\.";	mso-level-tab-stop:none;	mso-level-number-position:right;	margin-left:0in;	text-indent:0in;}@list l1:level2	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level3	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level4	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level5	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level6	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level7	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level8	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l1:level9	{mso-level-start-at:0;	mso-level-text:"";	mso-level-tab-stop:none;	mso-level-number-position:left;	margin-left:0in;	text-indent:0in;}@list l2	{mso-list-id:254018734;	mso-list-type:hybrid;	mso-list-template-ids:1650725614 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l2:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l3	{mso-list-id:392778190;	mso-list-type:hybrid;	mso-list-template-ids:909574044 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}@list l3:level1	{mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;}@list l4	{mso-list-id:630869635;	mso-list-type:hybrid;	mso-list-template-ids:1377588946 67698689 67698703 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l4:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l4:level2	{mso-level-tab-stop:1.0in;	mso-level-number-position:left;	text-indent:-.25in;}@list l5	{mso-list-id:641811962;	mso-list-type:hybrid;	mso-list-template-ids:-2100687092 67698703 67698689 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}@list l5:level1	{mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;}@list l5:level2	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:1.0in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l6	{mso-list-id:1334378800;	mso-list-type:hybrid;	mso-list-template-ids:1864399236 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}@list l6:level1	{mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;}@list l7	{mso-list-id:1408071216;	mso-list-type:hybrid;	mso-list-template-ids:-1192208472 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l7:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l8	{mso-list-id:1564441415;	mso-list-type:hybrid;	mso-list-template-ids:1151737696 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l8:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l9	{mso-list-id:1872259259;	mso-list-type:hybrid;	mso-list-template-ids:-314017652 67698689 67698703 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l9:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}@list l9:level2	{mso-level-tab-stop:1.0in;	mso-level-number-position:left;	text-indent:-.25in;}@list l10	{mso-list-id:2115438816;	mso-list-type:hybrid;	mso-list-template-ids:1656268550 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}@list l10:level1	{mso-level-number-format:bullet;	mso-level-text:\F0B7;	mso-level-tab-stop:.5in;	mso-level-number-position:left;	text-indent:-.25in;	font-family:Symbol;}ol	{margin-bottom:0in;}ul	{margin-bottom:0in;}--></style></head><body bgcolor=white lang=EN-US link=blue vlink=purple style='tab-interval:.5in'><div class=Section1><p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p><table border=1 cellspacing=0 cellpadding=0 width=419 style='width:418.95pt; margin-left:9.45pt;border-collapse:collapse;border:none;mso-border-top-alt: solid windowtext .5pt;mso-padding-alt:0in 5.4pt 0in 5.4pt'> <tr style='height:5.0pt'>  <td width=311 valign=top style='width:310.95pt;border:none;padding:0in 5.4pt 0in 5.4pt;  height:5.0pt'>  <p class=MsoNormal><span style='font-family:Arial'><b>CS262A: Advanced Topics  in Computer Systems<o:p></o:p></b></span></p>  <p class=MsoNormal><span style='font-family:Arial'><b>Joe Hellerstein and  Timothy Roscoe<o:p></o:p></b></span></p>  <p class=MsoNormal><span style='font-family:Arial'>UC Berkeley<o:p></o:p></span></p>  <p class=MsoNormal><span style='font-family:Arial'>Fall, 2005</span><b><o:p></o:p></b></p>  </td>  <td width=108 valign=top style='width:1.5in;border:none;padding:0in 5.4pt 0in 5.4pt;  height:5.0pt'>  <h1 align=right style='text-align:right'><span style='font-size:12.0pt'>Lecture  7<o:p></o:p></span></h1>  </td> </tr></table><h1><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></h1><h1>ACPM<o:p></o:p></h1><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Lots ofgood, sensible ideas in this paper.<span style="mso-spacerun: yes">&nbsp;</span>A nice simple design as well.<span style="mso-spacerun: yes">&nbsp;</span>(Mothy may have more to say there.)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>AttractiveCS262 paper: OS community learning lessons from the DB experiences &#8211;inability to influence page replacement policy in the VM. Not all apps are wellserved by a single policy, should be extensible/configurable.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Then again,maybe not!<span style="mso-spacerun: yes">&nbsp; </span>Dysfunctionalinteraction between OS and DB communities?<span style="mso-spacerun:yes">&nbsp; </span>Many misconceptions about DBMSs here!<spanstyle="mso-spacerun: yes">&nbsp; </span>Exposes deeper questions!<spanstyle="mso-spacerun: yes">&nbsp; </span><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Exploringthis kind of tension is just what we’re supposed to do in this class.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>ACPM Background<o:p></o:p></h2><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>First,let’s revisit some of V++’s basic storage units and metaphors:<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Disk block: a physical unit of     xfer <o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Page frame: block-sized unit of     physical memory (RAM)<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Segment: collection of page     frames providing a run of virtual addresses (not necessarily contiguous in     RAM).<span style="mso-spacerun: yes">&nbsp; </span>This is the unit of     extensible page management.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Bound Region: association     between two segments &#8211; essentially a reference to a (page-aligned)     sub-range of an underlying segment.<span style="mso-spacerun: yes">&nbsp;     </span>Provides a level of indirection to support, e.g., copy-on-write.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>File: traditional filesystem     abstraction of a named run of blocks on disk.<span style="mso-spacerun:     yes">&nbsp; </span>Can serve as backing store for a segment.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l9 level1 lfo1;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Cached file: a segment with a     block read/write interface.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>V++’s ACPMis targeted at exposing the following main issues to application level:<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <ol style='margin-top:0in' start=1 type=1>  <li class=MsoNormal style='mso-list:l9 level2 lfo1;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial;color:black'>The <b>amount</b></span><span      style='font-size:10.0pt;font-family:Arial;color:black'> of physical      memory available to the application.<span style="mso-spacerun:      yes">&nbsp; </span>Important if dynamic, presupposes significant <i>multiprogramming.</i></span><span      style='font-size:10.0pt;font-family:Arial'><o:p></o:p></span></li>  <li class=MsoNormal style='mso-list:l9 level2 lfo1;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial;color:black'><b>Spatiotemporal      control </b></span><span style='font-size:10.0pt;font-family:Arial;      color:black'>over physical memory.<span style="mso-spacerun: yes">&nbsp;      </span>Being able to choose which pages are in physical memory. Relevant      for both performance and correctness in a variety of settings.<span      style="mso-spacerun: yes">&nbsp; </span>Also relevant to NUMA      multiprocessor settings.</span><span style='font-size:10.0pt;font-family:      Arial'><o:p></o:p></span></li>  <li class=MsoNormal style='mso-list:l9 level2 lfo1;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial;color:black'><b>Temporal      control </b></span><span style='font-size:10.0pt;font-family:Arial;      color:black'>over I/O transitions into/out of memory.</span><span      style='font-size:10.0pt;font-family:Arial'><o:p></o:p></span></li> </ol></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial;color:black'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>DBMS Buffer Management Background<o:p></o:p></h2><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial;color:black'>Anaside: how do DBMSs manage their memory, and what do they stick into thatmemory?<span style="mso-spacerun: yes">&nbsp; </span><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial;color:black'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial;color:black'>Two/Threepools of heap memory:<o:p></o:p></span></p><ol style='margin-top:0in' start=1 type=1> <li class=MsoNormal style='mso-list:l5 level1 lfo2;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial;color:black'><b>Buffer pool: </b></span><span     style='font-size:10.0pt;font-family:Arial;color:black'>At boot time,     allocate a <i>buffer pool </i></span><span style='font-size:10.0pt;     font-family:Arial;color:black'>in virtual memory to serve as a cache for     database blocks.<span style="mso-spacerun: yes">&nbsp; </span>This is     usually sized to a large fraction of the physical memory on the machine.</span><span     style='font-size:10.0pt;font-family:Arial'><o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l5 level1 lfo2;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial;color:black'><b>Query workspace:</b></span><span     style='font-size:10.0pt;font-family:Arial'> Space for memory-intensive     query processing operations like sorting and hashing (e.g. for     joins).<span style="mso-spacerun: yes">&nbsp; </span><o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l5 level1 lfo2;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'><b>Miscellaneous heap space:</b></span><span     style='font-size:10.0pt;font-family:Arial'> E.g. the query parser needs     some heap space, the query optimizer consumes a nontrivial amount of     memory for dynamic programming, the DBMS lock table sits on the heap, etc.     (As an aside, most DBMSs implement a <i>region-based memory manager</i></span><span     style='font-size:10.0pt;font-family:Arial'> to allow for efficient     allocation and leak-free deallocation of such heap space.<span     style="mso-spacerun: yes">&nbsp; </span>A discussion of its own!)<o:p></o:p></span></li></ol><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><i>DBMSsmake heavy use of virtual memory, but a well-administered DBMS never causes VMto page.<span style="mso-spacerun: yes">&nbsp; </span>Why?<o:p></o:p></i></span></p><ol style='margin-top:0in' start=1 type=1> <li class=MsoNormal style='mso-list:l3 level1 lfo4;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>DBMSs are expensive servers,     run on a dedicated machine (since the dawn of time!)<span     style="mso-spacerun: yes">&nbsp; </span>No multiprogramming of note.<i><o:p></o:p></i></span></li> <li class=MsoNormal style='mso-list:l3 level1 lfo4;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Buffer pool and query workspace     sizes set to fit in physical memory.<span style="mso-spacerun: yes">&nbsp;     </span>Combined with (1), basically never pages.<i><o:p></o:p></i></span></li></ol><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>ACPM ismost relevant to the DBMS buffer pool.<span style="mso-spacerun: yes">&nbsp;</span>Here’s how buffer pools work in traditional OS contexts:<o:p></o:p></span></p><ol style='margin-top:0in' start=3 type=1> <ul style='margin-top:0in' type=disc>  <li class=MsoNormal style='mso-list:l5 level2 lfo2;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial'>Using proper OS I/O interface      to avoid <i><u>double-buffering</u></i></span><span style='font-size:      10.0pt;font-family:Arial'> with file cache (what are these in your      favorite OS?), DBMS requests individual DB blocks by address to be copied      into VM, and written back to disk.<span style="mso-spacerun: yes">&nbsp;      </span><o:p></o:p></span></li>  <li class=MsoNormal style='mso-list:l5 level2 lfo2;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial'>DBMS has its own app-level      semantics/implementation for <i>pin-counts, dirty pages, ref bits, </i></span><span      style='font-size:10.0pt;font-family:Arial'>etc.<span style="mso-spacerun:      yes">&nbsp; </span><o:p></o:p></span></li>  <li class=MsoNormal style='mso-list:l5 level2 lfo2;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial'>DBMS wants to control the      order of disk writes (e.g. for Write-Ahead Logging) for <i>correctness      &#8211;</i></span><span style='font-size:10.0pt;font-family:Arial'> not      just performance.<span style="mso-spacerun: yes">&nbsp; </span>Any virtualization      of physical write confirmations gives DBMS designers fits, and causes      them to work <i>around</i></span><span style='font-size:10.0pt;      font-family:Arial'> the interface rather than with it.<o:p></o:p></span></li>  <li class=MsoNormal style='mso-list:l5 level2 lfo2;tab-stops:list 1.0in'><span      style='font-size:10.0pt;font-family:Arial'>DBMS has intimate knowledge of      disk access patterns.<span style="mso-spacerun: yes">&nbsp; </span>This      leads to a desire for workload-sensitive buffer replacement policies and      block prefetching, both of which are based on patterns other than recency      and physical contiguity.<span style="mso-spacerun: yes">&nbsp;      </span>(See Chou/DeWitt for examples.)<o:p></o:p></span></li> </ul></ol><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>Returning to ACPM…<o:p></o:p></h2><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Could weimplement the DBMS buffer pool using V++ VM?<span style="mso-spacerun:yes">&nbsp; </span>You bet!<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l8 level1 lfo3;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>ACPM gives us app-level control     of page replacement, which is more or less what we<span     style="mso-spacerun: yes">&nbsp; </span>want. I.e. issue #2 of H&amp;C’s 3     issues.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l8 level1 lfo3;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'><i>However</i></span><span     style='font-size:10.0pt;font-family:Arial'>, all accesses in a DBMS are     page-oriented read/write, so this isn’t the VM interface, it’s just the     cached file interface.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l8 level1 lfo3;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>ACPM itself doesn’t seem to guarantee     that disk write notifications are real, though this is issue #3.<span     style="mso-spacerun: yes">&nbsp; </span>V++ seems to have the right     interfaces for that in its cache file implementation.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>But, DBmisconceptions rife in the paper:<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l10 level1 lfo6;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>The DB buffer pool is shared by     all running queries, and the DBMS can arbitrate the residency of pages     across the queries directly at application level &#8211; no OS support is     needed.<span style="mso-spacerun: yes">&nbsp; </span>Citation [17] and     follow-on work never lamented the lack of OS support, they just addressed     the policy question of how to allocate buffers across queries. So this     does not motivate the notion of<span style="mso-spacerun: yes">&nbsp;     </span>dynamically changing the allocation of pages across processes     (H&amp;C’s issue #1).<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l10 level1 lfo6;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Similarly, the DBMS can control     what DB pages are “pinned” in the (local) buffer pool &#8211; e.g. index     roots, etc.<span style="mso-spacerun: yes">&nbsp; </span>So this does not     motivate OS-level interfaces for control over physical memory placement     (H&amp;C issue #2).<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l10 level1 lfo6;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>They assume that database     indexes are mapped entirely into memory &#8211; i.e. they’re main-memory     data structures (a la red-black trees) rather than disk-oriented data     structures (a la B-trees).<span style="mso-spacerun: yes">&nbsp;&nbsp;     </span>This appears to be honest naivete. But it is madness to expect a     main-memory data structure in VM to have as good paging behavior as a     disk-oriented data structure.<span style="mso-spacerun: yes">&nbsp;     </span>More fundamentally, this underscores one of the papers own key     lessons about API design: <b>an API that is “transparent <i>except for     performance</i></b></span><span style='font-size:10.0pt;font-family:Arial'><b>”     is a lousy API for performance-oriented applications!</b></span><span     style='font-size:10.0pt;font-family:Arial'><span style="mso-spacerun:     yes">&nbsp; </span>(Remember that!)<span style="mso-spacerun: yes">&nbsp;     </span>So VM would never be used for “out-of-core” data structures and     computations &#8211; it’s a poor API for such things.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>So, howmuch does ACPM help the DBMS?<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l7 level1 lfo5;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Goal #1 is irrelevant because     multiprogramming and servers don’t go together.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l7 level1 lfo5;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Goal #2 is fine, but we’re only     using the cached file interface, not the VM interface, so this isn’t much     more helpful than just direct I/O.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l7 level1 lfo5;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Goal #3 is critical for correct     write-ahead logging, and useful for performance with respect to read-ahead     and write-batching. But this is an I/O subsystem issue, not a VM issue per     se.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Conclusion:there’s little here that makes a DBMS writer’s life much easier.<spanstyle="mso-spacerun: yes">&nbsp; </span>I suspect the same complaint applies toscientific and other applications.<span style="mso-spacerun: yes">&nbsp;</span>Basic issue is one of metaphor and API:<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l2 level1 lfo7;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>For big-data computations with     complex I/O patterns, VM is almost by definition “transparent except for     performance” regardless of the degree of control.<span     style="mso-spacerun: yes">&nbsp; </span>The data structures and algorithms     get written for paginated memory models rather than RAM pointer     models.<span style="mso-spacerun: yes">&nbsp; </span>There is an algorithms     literature around this (“out-of-core algorithms”, “indexability theory”,     etc.)<span style="mso-spacerun: yes">&nbsp; </span>Achieving this I/O     pattern while pretending to live in a pointer model is     near-impossible.<span style="mso-spacerun: yes">&nbsp; </span>So VM is the     wrong metaphor; fixing its API is misunderstanding the issue.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo7;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>One key motivation for the work     &#8211; multiprogramming &#8211; is undercut by the applications that     might want control.<span style="mso-spacerun: yes">&nbsp; </span>Big-data     computations (scientific apps, DBMS decision-support workloads) tend to be     done as batch jobs on dedicated hardware with minimal multiprogramming     (the only concurrent tasks are usual system daemons, etc.)<span     style="mso-spacerun: yes">&nbsp; </span>Multi-client parallel little-data     jobs (transaction processing, information retrieval, etc.) tend to use     servers which again run on dedicated HW with minimal multiprogramming.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Lessonshere in trying to please people without understanding their pain.<spanstyle="mso-spacerun: yes">&nbsp; </span>Or more likely, hammers in search ofnails.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h1>5 Minute Rule<o:p></o:p></h1><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Why readthis paper?<o:p></o:p></span></p><ol style='margin-top:0in' start=1 type=1> <li class=MsoNormal style='mso-list:l6 level1 lfo8;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Expose you to a style of     trend-driven systems thinking.<span style="mso-spacerun: yes">&nbsp;     </span>A way to identify research opportunities!<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l6 level1 lfo8;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Sensitize you to choosing <i>relevant,     portable</i></span><span style='font-size:10.0pt;font-family:Arial'>/scalable     metrics of performance.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l6 level1 lfo8;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Expose you to the disk access     issues that matter to DB applications &#8211; and discuss the way they     affect buffer replacement and prefetching.<o:p></o:p></span></li></ol><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>Trend-Driven problem identification<o:p></o:p></h2><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Jim Grayand Dave Patterson seem to push these the hardest.<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Idea: identify the pain point     that is coming 5-10 years down the line, and start doing the research on     it <i>now.</i></span><span style='font-size:10.0pt;font-family:Arial'><span     style="mso-spacerun: yes">&nbsp; </span>Remember the Gretzky’s Rule:     “Skate to where the puck is going!” (Though this is apparently apocryphal     and also bad hockey advice: <a     href="http://www.fastcompany.com/magazine/36/cdu.html">http://www.fastcompany.com/magazine/36/cdu.html</a>).<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Doing this well is rather an     art, even though hearing about it can be dry.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>This particular paper’s     analysis doesn’t identify a research problem per se, though it dispenses     with a number of proposed problems people have posed over the years.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>Performance Metrics<o:p></o:p></h2><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Economic <i>cost </i></span><span     style='font-size:10.0pt;font-family:Arial'>(as in $$) is a useful proxy     for issues in computing that are relevant to (capitalist) society.<span     style="mso-spacerun: yes">&nbsp; </span>Used to be a proxy for performance     or resource utilization.<span style="mso-spacerun: yes">&nbsp; </span>Now?<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Ratios of metrics can be more     telling than individual metrics.<span style="mso-spacerun: yes">&nbsp;     </span>When ratios remain the same, design tradeoffs tend to stay the     same.<span style="mso-spacerun: yes">&nbsp; </span>When ratios shift     substantially, you have a research opportunity.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>“Feature selection” &#8211;     identifying the right issues to measure &#8211; is a critical challenge     and a place for creativity in the realm of trend-driven research.<span     style="mso-spacerun: yes">&nbsp; </span>Again, economic cost is often a     good guide in our society, though this opens up a philosophical can of     worms.<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><h2>Access patterns in a DBMS (detail courtesy Chou/DeWitt):<o:p></o:p></h2><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>StraightSequential: LocSet size = 1. Replace that page as soon as needed.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>ClusteredSequential: LocSet size = (#tuples in largest cluster)/(# of tuples per page).FIFO or LRU replacement work.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>LoopingSequential: LocSet size = size of relation (“file”). MRU is best.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>IndependentRandom: odds of revisit are low, so LocSet either 1, or the magic number b fromthe &quot;Yao&quot; formula. <o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>ClusteredRandom: Just like CS, but pages are not packed onto blocks. So it’s just # oftuples in largest cluster. LRU or FIFO replacement.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>StraightHierarchical, Hierarchical/Straight Sequential: like Straight Sequential.<o:p></o:p></span></p><p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-pagination:none;mso-list:l4 level1 lfo9;tab-stops:11.0pt .5in 56.0pt 84.0pt 112.0pt 140.0pt 168.0pt 196.0pt 224.0pt 3.5in 280.0pt 308.0pt 336.0pt;mso-layout-grid-align:none;text-autospace:none'><![if !supportLists]><spanstyle='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><![endif]><span style='font-size:10.0pt;font-family:Arial'>Hierarchical/ClusteredSequential: like CS, but replace tuples with (key,ptr) pairs<o:p></o:p></span></p><ul style='margin-top:0in' type=disc> <li class=MsoNormal style='mso-list:l4 level1 lfo9;tab-stops:list .5in'><span     style='font-size:10.0pt;font-family:Arial'>Looping Hierarchical: at each     level h of an index, you have random access among pages. Use Yao to figure     out how many pages you’ll access at each level in <i>k</i></span><span     style='font-size:10.0pt;font-family:Arial'> lookups<o:p></o:p></span></li></ul><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:Arial'>Fully-specifiedmodels a la DBMIN?<span style="mso-spacerun: yes">&nbsp; </span>Simplestochastic models a la LRU, LRU-k?<span style="mso-spacerun: yes">&nbsp;</span>Something in between (“gray-box systems”)?<o:p></o:p></span></p></div></body></html>